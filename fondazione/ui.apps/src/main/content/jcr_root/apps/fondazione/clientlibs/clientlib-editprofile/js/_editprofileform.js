document.addEventListener("DOMContentLoaded",(function(){let e="",t=document.querySelector("#cmp-editprofileform__successAlert"),r=document.querySelector("#cmp-editprofileform__errorsAlert"),s=document.querySelector("#userProfileTab"),o=document.querySelector("#passwordTab"),n=document.querySelector("#userProfileComponent"),a=document.querySelector("#loaderUserDataComponent"),d=document.querySelector("#passwordComponent"),i=document.querySelector("#cmp-editprofileform__modal a");s.addEventListener("click",(()=>B("userProfileTab"))),o.addEventListener("click",(()=>B("passwordTab")));const c=document.querySelector("#dropdownMultiselectMenuButtonUserProfile"),l=document.querySelector("#interestListUserProfile"),u=l.querySelectorAll('input[type="checkbox"]');let m=[],p=[];const f=document.querySelector("#dropdownProfessionMenuButtonUserProfile"),L=document.querySelector("#professionListUserProfile"),y=document.querySelectorAll("#professionListUserProfile li div");let g="";const v=document.querySelector("#dropdownCountryMenuButtonUserProfile"),w=document.querySelector("#countryListUserProfile"),b=document.querySelectorAll("#countryListUserProfile li div");let S="",k="";i?.addEventListener("click",(()=>{!function(){let e=document.querySelector("#cmp-editprofileform__modal .modal"),t=document.querySelector("#cmp-editprofileform__overlay");e.classList.add("d-none"),e.classList.remove("d-block"),t.classList.add("d-none"),t.classList.remove("d-block")}()}));let h=[],_=document.querySelector("#userProfileCreationDate"),C=document.querySelector("#userProfileLastUpdatedOn"),q=document.querySelector("#firstName"),U=document.querySelector("#lastName"),P=document.querySelector("#linkedinProfile"),I=document.querySelector("#professionListUserProfile"),T=document.querySelector("#gender"),M=document.querySelector("#dateOfBirth"),E=document.querySelector("#telephone"),G=document.querySelector("#countryListUserProfile"),H=document.querySelector("#userProfileEmailAddress"),N=document.querySelector("#dropdownMultiselectMenuButtonUserProfile"),x=document.querySelector("#privacyYes"),D=document.querySelector("#dataProcessingYes"),A=document.querySelector("#dataProcessingNo"),O=document.querySelector("#newsletterYes"),R=document.querySelector("#newsletterNo"),j=document.querySelector("#taxIdCode"),Y=(document.querySelector("#fiscalCodeInput"),!1);function B(t){"userProfileTab"===t&&(e="userProfileTab",o.classList.remove("active"),s.classList.add("active"),n.classList.add("d-block"),n.classList.remove("d-none"),d.classList.remove("d-block"),d.classList.add("d-none")),"passwordTab"===t&&(e="passwordTab",s.classList.remove("active"),o.classList.add("active"),n.classList.add("d-none"),n.classList.remove("d-block"),d.classList.remove("d-none"),d.classList.add("d-block"))}function F(){let e=0===m.length?"Select Area of Interest":m.join(", ");"Select Area of Interest"!==e?c.classList.add("dropdown-toggle-filled"):c.classList.remove("dropdown-toggle-filled"),c.textContent=e}function J(){let e=""===g?"Select Profession":g,t=document.querySelector("#areaOfInterestsComponentUserProfile");g===Granite.I18n.get("no_healthcare")?(t.classList.add("d-none"),t.classList.remove("d-block"),m=[],p=[],F(),u.forEach((e=>{e.checked&&(e.checked=!1,e.disabled=!1)}))):(t.classList.add("d-block"),t.classList.remove("d-none")),"Select Profession"!==e?f.classList.add("dropdown-toggle-filled"):f.classList.remove("dropdown-toggle-filled"),f.textContent=e}function z(){let e=""===S?"Select Country":S;"Select Country"!==e?v.classList.add("dropdown-toggle-filled"):v.classList.remove("dropdown-toggle-filled"),v.textContent=e}function Z(e,t){t.classList.contains("d-block")?(e.classList.add("border-bottom-0"),e.classList.add("active-dropdown")):(e.classList.remove("border-bottom-0"),e.classList.remove("active-dropdown"))}function $(){let e=document.querySelector("#errorAlertChangePassword");e.classList.remove("d-block"),e.classList.add("d-none")}function K(){let e=document.querySelector("#successAlertChangePassword");e.classList.remove("d-block"),e.classList.add("d-none")}function Q(e){!function(){let e=document.querySelector("#professionErrorString"),t=document.querySelector("#dropdownProfessionMenuButtonUserProfile");""===g?(h.push({id:"profession",message:Granite.I18n.get("mandatory_field")}),e.innerHTML=Granite.I18n.get("mandatory_field"),t.classList.add("cmp-userprofileform__borderRed"),t.classList.remove("cmp-userprofileform__borderGreen")):(t.classList.remove("cmp-userprofileform__borderRed"),t.classList.add("cmp-userprofileform__borderGreen"),e.innerHTML="")}(),function(){let e=document.querySelector("#countryErrorString"),t=document.querySelector("#dropdownCountryMenuButtonUserProfile");""===S?(h.push({id:"country",message:Granite.I18n.get("mandatory_field")}),e.innerHTML=Granite.I18n.get("mandatory_field"),t.classList.add("cmp-userprofileform__borderRed"),t.classList.remove("cmp-userprofileform__borderGreen")):(t.classList.remove("cmp-userprofileform__borderRed"),t.classList.add("cmp-userprofileform__borderGreen"),e.innerHTML="")}(),function(e){let t=document.querySelector("#interestErrorString"),r=document.querySelector("#dropdownMultiselectMenuButtonUserProfile");e.areasOfInterest&&0!==e.areasOfInterest.length||g===Granite.I18n.get("no_healthcare")?(r.classList.remove("cmp-userprofileform__borderRed"),r.classList.add("cmp-userprofileform__borderGreen"),t.innerHTML=""):(h.push({id:"areasOfInterest",message:Granite.I18n.get("mandatory_field")}),t.innerHTML=Granite.I18n.get("mandatory_field"),r.classList.add("cmp-userprofileform__borderRed"),r.classList.remove("cmp-userprofileform__borderGreen"))}(e),function(e){let t=document.querySelector("#privacyErrorString");"no"!==e.privacy&&e.privacy?t.innerHTML="":(h.push({id:"privacy",message:Granite.I18n.get("accept_privacy")}),t.innerHTML=e.privacy&&"no"===e.privacy?Granite.I18n.get("accept_privacy_edit_profile"):Granite.I18n.get("mandatory_field"))}(e),function(e){let t=document.querySelector("#newsletterErrorString");e.personalDataProcessing?t.innerHTML="":(h.push({id:"personalDataProcessing",message:Granite.I18n.get("mandatory_field")}),t.innerHTML=Granite.I18n.get("mandatory_field"))}(e),function(e){let t=document.querySelector("#dataProcessingErrorString");e.receiveNewsletter?t.innerHTML="":(h.push({id:"receiveNewsletter",message:Granite.I18n.get("mandatory_field")}),t.innerHTML=Granite.I18n.get("mandatory_field"))}(e),function(e){let t=document.querySelector("#fiscalCodeErrorString");"1"!==S.toLowerCase()||e.taxIdCode&&""!==e.taxIdCode?(t.classList.remove("d-block"),t.classList.add("d-none"),t.innerHTML=""):(t.classList.add("d-block"),t.classList.remove("d-none"),h.push({id:"taxIdCode",message:Granite.I18n.get("mandatory_field")}),t.innerHTML=Granite.I18n.get("mandatory_field"))}(e)}function V(e){return/\d/.test(e)}function W(e){return/[^a-zA-Z0-9]/.test(e)}function X(e){return/[A-Z]/.test(e)}function ee(e){return/[a-z]/.test(e)}async function te(e){let t=document.querySelector("#ctaSaveUserProfile"),r=document.querySelector("#userProfileLoader");try{t.disabled=!0,r.classList.remove("d-none"),r.classList.add("d-block");const s=await fetch("/libs/granite/csrf/token.json"),o=await s.json(),n=await fetch("/private/api/user",{method:"POST",headers:{"CSRF-Token":o.token},body:JSON.stringify(e)}),a=await n.json();try{200!==(await fetch("/private/api/isSignIn",{method:"GET",headers:{"CSRF-Token":o.token}})).status&&(Y=!0,function(){let e=document.querySelector("#cmp-editprofileform__modal .modal"),t=document.querySelector("#cmp-editprofileform__overlay");e.classList.add("d-block"),e.classList.remove("d-none"),t.classList.add("d-block"),t.classList.remove("d-none")}())}catch(e){console.log("Error: ",e)}return a}catch(e){console.log(e)}finally{t.disabled=!1,r.classList.add("d-none"),r.classList.remove("d-block")}}async function re(e){let t=document.querySelector("#ctaSavePassword"),r=document.querySelector("#passwordLoader");t.disabled=!0;try{r.classList.remove("d-none"),r.classList.add("d-block");const s=await fetch("/libs/granite/csrf/token.json"),o=await s.json(),n=await fetch("/private/api/resetPassword",{method:"POST",headers:{"CSRF-Token":o.token},body:JSON.stringify(e)}),a=await n.json();return!0===a.success?(!function(){let e=document.querySelector("#successAlertChangePassword");e.classList.remove("d-none"),e.classList.add("d-block")}(),$()):(!function(){let e=document.querySelector("#errorAlertChangePassword");e.classList.remove("d-none"),e.classList.add("d-block")}(),K()),a}catch(e){console.error("Error:",e)}finally{t.disabled=!1,r.classList.add("d-none"),r.classList.remove("d-block")}}!async function(){n.classList.add("d-none"),n.classList.remove("d-block"),a.classList.add("d-block"),a.classList.remove("d-none");try{const e=await fetch("/libs/granite/csrf/token.json"),t=await e.json();200===(await fetch("/private/api/isSignIn",{method:"GET",headers:{"CSRF-Token":t.token}})).status&&(Y=!0)}catch(e){console.log("Error: ",e)}if(Y){const e=await fetch("/libs/granite/csrf/token.json"),t=await e.json(),r=await fetch("/private/api/user",{method:"GET",headers:{"CSRF-Token":t.token}}),s=await r.json();if(!0===s.success){if(q&&""!==s.updatedUser.firstname&&(q.value=s.updatedUser.firstname),U&&""!==s.updatedUser.lastname&&(U.value=s.updatedUser.lastname),P&&s.updatedUser.linkedinProfile&&""!==s.updatedUser.linkedinProfile&&(P.value=s.updatedUser.linkedinProfile),j&&s.updatedUser.taxIdCode&&""!==s.updatedUser.taxIdCode&&(j.value=s.updatedUser.taxIdCode),T&&""!==s.updatedUser.gender&&(T.value=s.updatedUser.gender),E&&""!==s.updatedUser.phone&&(E.value=s.updatedUser.phone),M&&""!==s.updatedUser.birthDate){moment.locale(s.updatedUser.country.toLowerCase());const e=s.updatedUser.birthDate,t=moment(e,"MMM D, YYYY").format("YYYY-MM-DD");M.value=t}if(H&&""!==s.updatedUser.email&&(H.textContent=s.updatedUser.email),_&&""!==s.updatedUser.createdOn){const e=moment(s.updatedUser.createdOn).format("L");_.textContent=e}if(C&&""!==s.updatedUser.lastUpdatedOn){const e=moment(s.updatedUser.lastUpdatedOn).format("L");C.textContent=e}if(G&&""!==s.updatedUser.country){let e=document.querySelector("#taxIdCode"),t=document.querySelector("#fiscalCodeUserProfileTitle");b.forEach((e=>{s.updatedUser.country===e.getAttribute("data-country-id")&&(S=e.textContent.trim(),k=e.getAttribute("data-country-id"))})),"1"===k?(e.classList.remove("d-none"),e.classList.add("d-block"),t.classList.add("d-block"),t.classList.remove("d-none")):(e.classList.add("d-none"),e.classList.remove("d-block"),t.classList.add("d-none"),t.classList.remove("d-block")),z()}I&&""!==s.updatedUser.occupation&&(g=s.updatedUser.occupation,g===Granite.I18n.get("no_healthcare")&&(m=[],p=[],F(),u.forEach((e=>{e.checked&&(e.checked=!1,e.disabled=!1)}))),J()),N&&s?.updatedUser?.registeredUserTopics?.length>0&&(s.updatedUser.registeredUserTopics.forEach((e=>{u.forEach((t=>{t.dataset.topicId===e.topic.id&&(t.checked=!0,t.disabled=!1,m.push(t.dataset.topicName),p.push(e.topic.id))})),u.forEach((e=>{!1===e.checked&&s.updatedUser.dataResponse?.updatedUser?.registeredUserTopics?.length>=3&&(e.disabled=!0)}))})),F()),x&&"1"===s.updatedUser.personalDataProcessingConsent&&(x.checked=!0),privacyNo&&"0"===s.updatedUser.personalDataProcessingConsent&&(privacyNo.checked=!0),D&&"1"===s.updatedUser.profilingConsent&&(D.checked=!0),A&&"0"===s.updatedUser.profilingConsent&&(A.checked=!0),O&&"1"===s.updatedUser.newsletterSubscription&&(O.checked=!0),R&&"0"===s.updatedUser.newsletterSubscription&&(R.checked=!0)}n.classList.add("d-block"),n.classList.remove("d-none"),a.classList.add("d-none"),a.classList.remove("d-block")}}(),c.addEventListener("click",(()=>{l.classList.contains("d-block")?(l.classList.add("d-none"),l.classList.remove("d-block")):(l.classList.remove("d-none"),l.classList.add("d-block")),Z(c,l)})),document.addEventListener("click",(function(e){c.contains(e.target)||l.contains(e.target)||(l.classList.add("d-none"),l.classList.remove("d-block")),f.contains(e.target)||L.contains(e.target)||(L.classList.add("d-none"),L.classList.remove("d-block")),v.contains(e.target)||w.contains(e.target)||(w.classList.add("d-none"),w.classList.remove("d-block")),Z(c,l),Z(f,L),Z(v,w)})),u.forEach((e=>{e.addEventListener("change",(function(){m.length<=3&&!0===e.checked&&!m.includes(e.dataset.topicName)&&(m.push(e.dataset.topicName),p.push(e.dataset.topicId)),m.length<=3&&!1===e.checked&&m.includes(e.dataset.topicName)&&(m=m.filter((t=>t!==e.dataset.topicName)),p.forEach(((t,r)=>{t===e.dataset.topicId&&p.splice(r,1)}))),u.forEach((e=>{m.includes(e.dataset.topicName)||3!==m.length?e.disabled=!1:e.disabled=!0})),F()}))})),f.addEventListener("click",(()=>{L.classList.contains("d-block")?(L.classList.add("d-none"),L.classList.remove("d-block")):(L.classList.remove("d-none"),L.classList.add("d-block")),Z(f,L)})),v.addEventListener("click",(()=>{w.classList.contains("d-block")?(w.classList.add("d-none"),w.classList.remove("d-block")):(w.classList.remove("d-none"),w.classList.add("d-block")),Z(v,w)})),y.forEach((e=>{e.addEventListener("click",(function(){g=e.textContent.trim(),L.classList.add("d-none"),L.classList.remove("d-block"),Z(f,L),J()}))})),b.forEach((e=>{let t=document.querySelector("#taxIdCode"),r=document.querySelector("#fiscalCodeErrorString");e.addEventListener("click",(function(){let s=e.getAttribute("data-country-id"),o=document.querySelector("#fiscalCodeUserProfileTitle");S=e.textContent.trim(),w.classList.add("d-none"),w.classList.remove("d-block"),k=e.getAttribute("data-country-id"),Z(v,w),z(),"1"===s.toLowerCase()?(t.classList.remove("d-none"),t.classList.add("d-block"),r.classList.add("d-block"),r.classList.remove("d-none"),o.classList.add("d-block"),o.classList.remove("d-none")):(t.classList.add("d-none"),t.classList.remove("d-block"),o.classList.add("d-none"),o.classList.remove("d-block"),r.classList.add("d-none"),r.classList.remove("d-block"))}))}));let se=document.querySelector("#userProfileForm");se&&se.addEventListener("submit",(async e=>{r.classList.remove("d-block"),r.classList.add("d-none"),t.classList.remove("d-block"),t.classList.add("d-none"),h=[],e.preventDefault();const s=new FormData(se);let o={profession:g,country:k,areasOfInterest:g!==Granite.I18n.get("no_healthcare")?p:[]};for(let[e,t]of s.entries())o={...o,[`${e}`]:t};let n={firstName:o.firstName,lastName:o.lastName,birthDate:o.dateOfBirth.replaceAll("-",""),profession:o.profession,phone:o.telNumber,country:o.country,taxIdCode:o.taxIdCode&&"1"===k?o.taxIdCode:"",interests:o.areasOfInterest,gender:o.gender,privacyConsent:"yes"===o.privacy,profilingConsent:"yes"===o.personalDataProcessing,newsletterConsent:"yes"===o.receiveNewsletter,linkedinProfile:o.linkedinProfile?o.linkedinProfile:null};if(Q(o),0===h.length){const e=await te(n);e.cognitoSignUpErrorResponseDto?r.classList.includes("d-block")||(a=JSON.stringify(e.cognitoSignUpErrorResponseDto.message),r&&a&&""!==a&&(r.classList.contains("d-none")&&a?(r.innerHTML=a.slice(1,-1),r.classList.remove("d-none"),r.classList.add("d-block")):(r.classList.remove("d-block"),r.classList.add("d-none")))):t.classList.contains("d-none")&&t&&(t.classList.contains("d-none")?(t.classList.remove("d-none"),t.classList.add("d-block")):(t.classList.add("d-none"),t.classList.none("d-block")))}var a}));let oe=document.querySelector("#passwordForm");oe&&oe.addEventListener("submit",(async e=>{$(),K(),function(){let e=document.querySelector("#passwordErrorString"),t=document.querySelector("#passwordConfirmationErrorString");e.innerHTML="",t.innerHTML=""}(),h=[],e.preventDefault();const t=new FormData(oe);let r={};for(let[e,s]of t.entries())r={...r,[`${e}`]:s};let s={PreviousPassword:r.currentPassword,ProposedPassword:r.password},o=function(e){let t=document.querySelector("#passwordErrorString");return e.password&&e.password!==e.passwordConfirmation||e.password&&!e.passwordConfirmation?(t.innerHTML=Granite.I18n.get("password_form_error"),!1):e.password&&e.password.length<8?(t.innerHTML=Granite.I18n.get("password_length_error"),!1):e.password&&!V(e.password)?(t.innerHTML=Granite.I18n.get("password_number_error"),!1):e.password&&!W(e.password)?(t.innerHTML=Granite.I18n.get("password_special_character_error"),!1):e.password&&!X(e.password)?(t.innerHTML=Granite.I18n.get("password_uppercase_error"),!1):e.password&&!ee(e.password)?(t.innerHTML=Granite.I18n.get("password_lowercase_error"),!1):!!e.password||(t.innerHTML=Granite.I18n.get("mandatory_field"),!1)}(r),n=function(e){let t=document.querySelector("#passwordConfirmationErrorString");return e.passwordConfirmation&&e.passwordConfirmation!==e.password||e.passwordConfirmation&&!e.password?(t.innerHTML=Granite.I18n.get("password_form_error"),!1):e.passwordConfirmation&&e.passwordConfirmation.length<8?(t.innerHTML=Granite.I18n.get("password_length_error"),!1):e.passwordConfirmation&&!V(e.passwordConfirmation)?(t.innerHTML=Granite.I18n.get("password_number_error"),!1):e.passwordConfirmation&&!W(e.passwordConfirmation)?(t.innerHTML=Granite.I18n.get("password_special_character_error"),!1):e.passwordConfirmation&&!X(e.passwordConfirmation)?(t.innerHTML=Granite.I18n.get("password_uppercase_error"),!1):e.passwordConfirmation&&!ee(e.passwordConfirmation)?(t.innerHTML=Granite.I18n.get("password_lowercase_error"),!1):!!e.passwordConfirmation||(t.innerHTML=Granite.I18n.get("mandatory_field"),!1)}(r);o&&n&&re(s)}))}));
let signInForm=document.querySelector("#signInForm"),alertBtn=document.querySelector("#alertBtn");async function sendData(e){let o=document.querySelector("#submitBtnSignin"),s=document.querySelector("#signinLoader");o.disabled=!0;try{s.classList.remove("d-none"),s.classList.add("d-block");const n=await fetch("/libs/granite/csrf/token.json"),r=await n.json(),t=await fetch("/bin/api/awsSignIn",{method:"POST",headers:{"CSRF-Token":r.token},body:JSON.stringify(e)});return await t.json()}catch(e){console.log("ERROR: ",e)}finally{o.disabled=!1,s.classList.remove("d-block"),s.classList.add("d-none")}}function showAlert(e){let o=$("#alertBox");o&&($("#alertMessage").html("<div>"+e+"</div>"),o.show())}function setFieldAsNotValid(){var e=document.getElementsByClassName("needs-validation");Array.prototype.filter.call(e,(function(e){e.addEventListener("submit",(function(o){!1===e.checkValidity()&&(o.preventDefault(),o.stopPropagation()),e.classList.add("was-validated")}),!1)}))}console.log("SIGNIN FORM"),document.addEventListener("DOMContentLoaded",(function(){let e=document.querySelector("#forgotPasswordLink"),o=document.querySelector("#signinLink"),s=document.querySelector("#signinLinkReset"),n=document.querySelector("#resetPasswordEmailForm"),r=document.querySelector("#resetPasswordEmailSubmit"),t=document.querySelector("#resetPasswordForm"),a=document.querySelector("#signupSection"),i=document.querySelector("#resetPasswordCodeCta"),d="";function l(e){return/\d/.test(e)}function c(e){return/[^a-zA-Z0-9]/.test(e)}function m(e){return/[A-Z]/.test(e)}function u(e){return/[a-z]/.test(e)}e.addEventListener("click",(()=>{signInForm.classList.remove("d-block"),signInForm.classList.add("d-none"),a.classList.remove("d-block"),a.classList.add("d-none"),n.classList.add("d-block"),n.classList.remove("d-none")})),o.addEventListener("click",(()=>{signInForm.classList.add("d-block"),signInForm.classList.remove("d-none"),n.classList.remove("d-block"),n.classList.add("d-none"),a.classList.remove("d-none"),a.classList.add("d-block")})),s.addEventListener("click",(()=>{signInForm.classList.add("d-block"),signInForm.classList.remove("d-none"),t.classList.remove("d-block"),t.classList.add("d-none"),a.classList.remove("d-none"),a.classList.add("d-block")})),n&&n.addEventListener("submit",(async e=>{e.preventDefault();let o={email:new FormData(n).get("emailFieldResetPassword")};d=o.email,function(){let e=document.querySelector("#alertMessageEmailForm"),o=document.querySelector("#alertBoxEmailForm");e.classList.remove("d-block"),e.classList.add("d-none"),o.classList.remove("d-block"),o.classList.add("d-none")}();const s=await fetch("/libs/granite/csrf/token.json"),a=await s.json();if(function(){let e=document.querySelector("#emailFieldResetPassword"),o=document.querySelector("#emailErrorString");return e&&!e.value.toString().includes("@")?(o.innerHTML=Granite.I18n.get("email_not_valid"),!1):!(!e||""===e.value)||(o.innerHTML=Granite.I18n.get("mandatory_field"),!1)}()){r.disabled=!0;let e=document.querySelector("#formEmailLoader");e.classList.remove("d-none"),e.classList.add("d-block");try{const s=await fetch("/bin/api/forgetPassword",{method:"POST",headers:{"Content-Type":"application/json","CSRF-Token":a.token},body:JSON.stringify(o)});await s.json();s.ok?(n.classList.remove("d-block"),n.classList.add("d-none"),t.classList.remove("d-none"),t.classList.add("d-block")):function(e){let o=document.querySelector("#alertMessageEmailForm"),s=document.querySelector("#alertBoxEmailForm");o&&e&&""!==e&&o.classList.contains("d-none")&&(o.innerHTML=e,s.classList.remove("d-none"),s.classList.add("d-block"),o.classList.remove("d-none"),o.classList.add("d-block"))}(Granite.I18n.get("error_sanding_code"))}catch(e){console.log("ERROR: ",e)}finally{r.disabled=!1,e.classList.remove("d-block"),e.classList.add("d-none")}}})),t&&t.addEventListener("submit",(async e=>{e.preventDefault(),function(){let e=document.querySelector("#passwordConfirmationErrorString"),o=document.querySelector("#passwordErrorString"),s=document.querySelector("#codeErrorString");e&&(e.innerHTML=""),o&&(o.innerHTML=""),s&&(s.innerHTML="")}(),function(){let e=document.querySelector("#alertMessageCodeForm"),o=document.querySelector("#alertBoxCodeForm");e.classList.remove("d-block"),e.classList.add("d-none"),o.classList.remove("d-block"),o.classList.add("d-none")}();const o=new FormData(t);let s={code:o.get("codeField"),password:o.get("passwordField"),passwordConfirmation:o.get("passwordConfirmationField")},n=function(e){let o=document.querySelector("#codeErrorString");return!!e.code||(o.innerHTML=Granite.I18n.get("mandatory_field"),!1)}(s),r=function(e){let o=document.querySelector("#passwordErrorString");return e.password&&e.password!==e.passwordConfirmation||e.password&&!e.passwordConfirmation?(o.innerHTML=Granite.I18n.get("password_form_error"),!1):e.password&&e.password.length<8?(o.innerHTML=Granite.I18n.get("password_length_error"),!1):e.password&&!l(e.password)?(o.innerHTML=Granite.I18n.get("password_number_error"),!1):e.password&&!c(e.password)?(o.innerHTML=Granite.I18n.get("password_special_character_error"),!1):e.password&&!m(e.password)?(o.innerHTML=Granite.I18n.get("password_uppercase_error"),!1):e.password&&!u(e.password)?(o.innerHTML=Granite.I18n.get("password_lowercase_error"),!1):!!e.password||(o.innerHTML=Granite.I18n.get("mandatory_field"),!1)}(s),L=function(e){let o=document.querySelector("#passwordConfirmationErrorString");return e.passwordConfirmation&&e.passwordConfirmation!==e.password||e.passwordConfirmation&&!e.password?(o.innerHTML=Granite.I18n.get("password_form_error"),!1):e.passwordConfirmation&&e.passwordConfirmation.length<8?(o.innerHTML=Granite.I18n.get("password_length_error"),!1):e.passwordConfirmation&&!l(e.passwordConfirmation)?(o.innerHTML=Granite.I18n.get("password_number_error"),!1):e.passwordConfirmation&&!c(e.passwordConfirmation)?(o.innerHTML=Granite.I18n.get("password_special_character_error"),!1):e.passwordConfirmation&&!m(e.passwordConfirmation)?(o.innerHTML=Granite.I18n.get("password_uppercase_error"),!1):e.passwordConfirmation&&!u(e.passwordConfirmation)?(o.innerHTML=Granite.I18n.get("password_lowercase_error"),!1):!!e.passwordConfirmation||(o.innerHTML=Granite.I18n.get("mandatory_field"),!1)}(s),g={email:d,confirmCode:o.get("codeField"),password:o.get("passwordField")};const w=await fetch("/libs/granite/csrf/token.json"),p=await w.json();if(r&&L&&n)try{let e=document.querySelector("#formCodeLoader");e.classList.remove("d-none"),e.classList.add("d-block"),i.disabled=!0;(await fetch("/bin/api/confirmForgetPassword",{method:"POST",headers:{"Content-Type":"application/json","CSRF-Token":p.token},body:JSON.stringify(g)})).ok?(t.classList.remove("d-block"),t.classList.add("d-none"),signInForm.classList.add("d-block"),signInForm.classList.remove("d-none"),a.classList.remove("d-none"),a.classList.add("d-block")):function(e){let o=document.querySelector("#alertMessageCodeForm"),s=document.querySelector("#alertBoxCodeForm");o&&e&&""!==e&&o.classList.contains("d-none")&&(o.innerHTML=e,s.classList.remove("d-none"),s.classList.add("d-block"),o.classList.remove("d-none"),o.classList.add("d-block"))}("Wrong code or password")}catch(e){console.log("ERROR: ",e)}finally{i.disabled=!1,e.classList.remove("d-block"),e.classList.add("d-none")}}))})),alertBtn&&alertBtn.addEventListener("click",(e=>{let o=$("#alertBox");o&&o.hide()})),signInForm&&signInForm.addEventListener("submit",(async e=>{e.preventDefault();let o="on"===new FormData(signInForm).get("rememberCheck"),s=document.querySelector("#emailField"),n=document.querySelector("#passField"),r={email:s.value,password:n.value,rememberMe:o};const t=await sendData(r);if(t.cognitoSignInErrorResponseDto?.message)showAlert(void 0!==t.cognitoSignInErrorResponseDto?.message?t.cognitoSignInErrorResponseDto.message:"Error");else{const e=sessionStorage.getItem("redirectUrl");document.location.href=e}})),window.addEventListener("load",(function(){setFieldAsNotValid()}),!1);